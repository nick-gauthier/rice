---
title: "CHELSA Download"
format: html
editor: visual
---

## Quarto

Quarto enables you to weave together content and executable code into a finished document. To learn more about Quarto see <https://quarto.org>.

## Running Code

When you click the **Render** button a document will be generated that includes both content and the output of embedded code. You can embed code like this:

```{r}
library(stars)

url <- 'https://os.zhdk.cloud.switch.ch/envicloud/chelsa/chelsa_V1/chelsa_trace/bio/'
#filenames <- RCurl::getURL(url)

test <- read_stars('/vsicurl/https://os.zhdk.cloud.switch.ch/envicloud/chelsa/chelsa_V1/chelsa_trace/bio/CHELSA_TraCE21k_bio01_-100_V1.0.tif', proxy = TRUE)

  

plot(test)
```

You can add options to executable code like this

The `echo: false` option disables the printing of code (only output is displayed).

```{r}
library(stars)

test2 <- read_stars('/vsicurl/https://os.zhdk.cloud.switch.ch/envicloud/chelsa/chelsa_V1/chelsa_trace/bio/CHELSA_TraCE21k_bio01_-100_V1.0.tif', proxy = TRUE)  %>%
  st_crop(bbox)

write_stars(test2, 'test.tif')
bbox <- st_bbox(c(xmin = 60, xmax = 150, ymin = -20, ymax = 50), crs = 4326)

plot(test2)
```

```{r}
library(tidyverse)
paths <- read_csv('envidatS3paths.txt', col_names = FALSE) %>%
  filter(str_detect(X1, 'bio02')) %>%
  pull()
bbox <- st_bbox(c(xmin = 60, xmax = 150, ymin = -20, ymax = 50), crs = 4326)

new_order <- paths %>% str_split('_') %>% map_chr(~.x[6]) %>% as.numeric() %>% order

paths[new_order] %>%
  paste0('/vsicurl/', .) %>%
  read_stars(proxy = TRUE)  %>%
  st_crop(bbox) %>%
  write_stars('trace_bio10.tif')
```

```{r}
c("https://os.zhdk.cloud.switch.ch/envicloud/chelsa/chelsa_V1/chelsa_trace/bio/CHELSA_TraCE21k_bio02_20_V1.0.tif", 
"https://os.zhdk.cloud.switch.ch/envicloud/chelsa/chelsa_V1/chelsa_trace/bio/CHELSA_TraCE21k_bio02_-40_V1.0.tif") %>%
    paste0('/vsicurl/', .) %>%
    read_stars(proxy = TRUE)  %>%
  st_crop(bbox) %>%
  write_stars('trace_bio02.tif')

c("https://os.zhdk.cloud.switch.ch/envicloud/chelsa/chelsa_V1/chelsa_trace/bio/CHELSA_TraCE21k_bio03_20_V1.0.tif", 
"https://os.zhdk.cloud.switch.ch/envicloud/chelsa/chelsa_V1/chelsa_trace/bio/CHELSA_TraCE21k_bio03_-40_V1.0.tif") %>%
    paste0('/vsicurl/', .) %>%
    read_stars(proxy = TRUE)  %>%
  st_crop(bbox) %>%
  write_stars('trace_bio03.tif')

c("https://os.zhdk.cloud.switch.ch/envicloud/chelsa/chelsa_V1/chelsa_trace/bio/CHELSA_TraCE21k_bio15_20_V1.0.tif", 
"https://os.zhdk.cloud.switch.ch/envicloud/chelsa/chelsa_V1/chelsa_trace/bio/CHELSA_TraCE21k_bio15_-40_V1.0.tif") %>%
    paste0('/vsicurl/', .) %>%
    read_stars(proxy = TRUE)  %>%
  st_crop(bbox) %>%
  write_stars('trace_bio15.tif'
```

```{r}

```
